<!DOCTYPE html>
<html xmlns:t="http://twistedmatrix.com/ns/twisted.web.template/0.1" t:render="root">

  <head t:render="head">
    <script><t:attr name="src"><t:slot name="moment_js_url" /></t:attr></script>
    <script><t:attr name="src"><t:slot name="ims_js_url" /></t:attr></script>
  </head>

  <body><div t:render="container">

    <div class="row">
      <div class="col-sm-4 text-left">
        <label id="incident_number_label">Incident #:</label> <t:slot name="incident_number" />
      </div>
      <div class="col-sm-4 text-center">
        <label>State:</label>
        <select name="state" onchange="update_state()">
          <option value="new"        t:render="state_option">New       </option>
          <option value="on_hold"    t:render="state_option">On Hold   </option>
          <option value="dispatched" t:render="state_option">Dispatched</option>
          <option value="on_scene"   t:render="state_option">On Scene  </option>
          <option value="closed"     t:render="state_option">Closed    </option>
        </select>
      </div>
      <div class="col-sm-4 text-right">
        <label>Priority:</label>
        <select name="priority" onchange="update_priority()">
          <option value="1" t:render="priority_option">High  </option>
          <option value="3" t:render="priority_option">Normal</option>
          <option value="5" t:render="priority_option">Low   </option>
        </select>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12">
        <div class="well well-sm">
          <label>Summary:</label>
          <input id="incident_summary" type="text" name="summary" placeholder="One-line summary of incidentâ€¦" inputmode="latin-prose" onchange="update_summary()" />
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-6">
        <label>Rangers:</label>
        <div class="well well-sm">
          <ul id="incident_rangers_list" class="list-group">
            <li class="list-group-item" />
          </ul>
        </div>
      </div>
      <div class="col-sm-6">
        <label>Incident Types</label>
        <div class="well well-sm">
          <ul id="incident_types_list" class="list-group">
            <li class="list-group-item" />
          </ul>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12">
        <label>Location</label>
        <div class="well well-sm">
          xxxx
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12">
        <label>Incident Report</label>
        <div class="well well-sm">
          xxxx
        </div>
      </div>
    </div>

    <script>
      var incident = <javascript t:render="incidentJSON" />;

      //<![CDATA[

      // Populate incident summary

      function drawSummary() {
        var summary = summarizeIncident(incident);

        $("#incident_summary").attr("value", summary);
      }

      drawSummary();

      // Populate Rangers list

      var rangerItem = $("#incident_rangers_list").children(".list-group-item:first");

      function drawRangers() {
        var items = [];

        for (var i in incident.ranger_handles) {
          var item = rangerItem.clone();
          item.append(incident.ranger_handles[i]);
          items.push(item);
        }

        $("#incident_rangers_list").empty().append(items);
      }

      drawRangers();

      // Populate incident types list

      var typesItem = $("#incident_types_list").children(".list-group-item:first");

      function drawIncidentTypes() {
        var items = [];

        for (var i in incident.incident_types) {
          var item = typesItem.clone();
          item.append(incident.incident_types[i]);
          items.push(item);
        }

        $("#incident_types_list").empty().append(items);
      }

      drawIncidentTypes();

      //]]>
    </script>

  </div></body>

</html>
