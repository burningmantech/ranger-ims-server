<!DOCTYPE html>
<html xmlns:t="http://twistedmatrix.com/ns/twisted.web.template/0.1" t:render="root">

  <head t:render="head">
    <script><t:attr name="src"><t:slot name="moment_js_url" /></t:attr></script>
    <script><t:attr name="src"><t:slot name="ims_js_url" /></t:attr></script>
  </head>

  <body><div t:render="container">

    <div class="row">
      <div class="col-sm-4 text-left">
        <label>Incident #:</label>
        <span id="incident_number" />
      </div>
      <div class="col-sm-4 text-center">
        <label>State:</label>
        <select id="incident_state" onchange="update_state()">
          <option value="new"       >New       </option>
          <option value="on_hold"   >On Hold   </option>
          <option value="dispatched">Dispatched</option>
          <option value="on_scene"  >On Scene  </option>
          <option value="closed"    >Closed    </option>
        </select>
      </div>
      <div class="col-sm-4 text-right">
        <label>Priority:</label>
        <select id="incident_priority" onchange="update_priority()">
          <option value="High"  >High  </option>
          <option value="Normal">Normal</option>
          <option value="Low"   >Low   </option>
        </select>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12">
        <div class="well well-sm flex-input-container">
          <label>Summary:</label>
          <input
            id="incident_summary" class="form-control"
            type="text" inputmode="latin-prose"
            placeholder="One-line summary of incidentâ€¦"
            onchange="update_summary()"
          />
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-6">
        <label>Rangers:</label>
        <div class="well well-sm">
          <ul id="incident_rangers_list" class="list-group list-group-small">
            <li class="list-group-item" />
          </ul>
        </div>
      </div>
      <div class="col-sm-6">
        <label>Incident Types</label>
        <div class="well well-sm">
          <ul id="incident_types_list" class="list-group list-group-small">
            <li class="list-group-item" />
          </ul>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12">
        <label>Location</label>
        <div class="well well-sm">
          xxxx
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-sm-12">
        <label>Incident Report</label>
        <div class="well well-sm">
          xxxx
        </div>
      </div>
    </div>

    <script>
      var incident = <javascript t:render="incidentJSON" />;

      //<![CDATA[

      // Populate incident number

      function drawNumber() {
        $("#incident_number").text(incident.number);
      }

      drawNumber();

      // Populate incident state

      function drawState() {
        var state = stateForIncident(incident);
        var statePopUp = $("#incident_state");

        statePopUp
          .children("option")
          .prop("selected", false)
          ;

        statePopUp
          .children("option[value='" + state + "']")
          .prop("selected", true)
          ;
      }

      drawState();

      // Populate incident priority

      function drawPriority() {
        var priority = priorityNameFromNumber(incident.priority);
        var priorityPopUp = $("#incident_priority");

        priorityPopUp
          .children("option")
          .prop("selected", false)
          ;

        priorityPopUp
          .children("option[value='" + priority + "']")
          .prop("selected", true)
          ;
      }

      drawPriority();

      // Populate incident summary

      function drawSummary() {
        var summary = summarizeIncident(incident);

        $("#incident_summary").attr("value", summary);
      }

      drawSummary();

      // Populate Rangers list

      var rangerItem = $("#incident_rangers_list").children(".list-group-item:first");

      function drawRangers() {
        var items = [];

        for (var i in incident.ranger_handles) {
          var item = rangerItem.clone();
          item.append(incident.ranger_handles[i]);
          items.push(item);
        }

        $("#incident_rangers_list").empty().append(items);
      }

      drawRangers();

      // Populate incident types list

      var typesItem = $("#incident_types_list").children(".list-group-item:first");

      function drawIncidentTypes() {
        var items = [];

        for (var i in incident.incident_types) {
          var item = typesItem.clone();
          item.append(incident.incident_types[i]);
          items.push(item);
        }

        $("#incident_types_list").empty().append(items);
      }

      drawIncidentTypes();

      //]]>
    </script>

  </div></body>

</html>
